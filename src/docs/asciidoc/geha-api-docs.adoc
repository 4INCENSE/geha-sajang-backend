= ✨게하사장✨ API Docs
0.0.1, 2020/08/13
:toc: left
:sectnums:
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toclevels: 5
:sectlinks:

[[overview]]
= 개요

👩‍💻👨‍💻👩‍💻👨‍💻INCENSE 게하사장 서비스의 API를 정리해놓은 문서입니다.

서버가 API서버이므로 기본 Url은 **/api/v1(버전)/~** 입니다.

예) `http://13.124.108.177:8080/api/v1/houses/1`

- method는 아래와 같습니다.

|===
| Method | Content

| `GET`
| 읽기

| `POST`
| 추가

| `PATCH`
| 수정

| `DELETE`
| 삭제
|===

- Http Status Code는 아래와 같습니다.

|===
| Status code | Usage

| `200 OK`
| 요청이 성공했습니다.

| `201 Created`
| 요청한 리소스가 생성되었습니다.

| `204 No Content`
| 요청은 성공했지만 특별한 Response는 없습니다.

| `400 Bad Request`
| 잘못된 요청입니다.

| `404 Not Found`
| 리소스를 찾을 수 없습니다.

| `409 Conflict`
| DB에 이미 존재하는 데이터입니다.

| `500 INTERNAL_SERVER_ERROR`
| 서버 내부 에러입니다.
|===

- 내부적으로 사용하는 에러코드는 아래와 같습니다.

??? 주로 유효성 검사
|===
| Error code | Status | Message

| `???`
|  400
|  입력값이 올바르지 않습니다

|===

House 관련
|===
| Error code | Status | Message

| `HO_001`
|  404
|  해당 하우스를 찾을 수 없습니다.

| `HO_002`
|  400
|  지정된 숫자를 초과하였습니다.

|===

호스트 관련
|===
| Error code | Status | Message

| `US_001`
|  409
|  이미 등록된 호스트입니다.

| `US_002`
|  404
|  호스트를 찾을 수 없습니다.

| `US_003`
|  401
|  인증키가 올바르지 않습니다.

| `US_004`
|  401
|  이미 인증이 완료된 호스트입니다.

| `US_005`
|  401
|  만료된 인증키입니다.

|===

이미지 관련
|===
| Error code | Status | Message

| `IMG_001`
|  500
|  10MB이하의 파일만 가능합니다

| `IMG_002`
|  500
|  MultipartFile -> File로 전환이 실패했습니다

|===

메일 관련
|===
| Error code | Status | Message

| `MA_001`
|  500
|  메일 전송에 실패했습니다

|===

== House 관련 API

=== GET /houses/{houseId}
ver1: 요청한 house id의 house 정보를 가져옵니다.

==== 200 성공
요청한 House의 정보를 성공적으로 가져옵니다.

- HTTP Request
include::{snippets}/house-controller-test/get-house-info-success/http-request.adoc[]

- HTTP Response
include::{snippets}/house-controller-test/get-house-info-success/http-response.adoc[]

- Path parameters
include::{snippets}/house-controller-test/get-house-info-success/path-parameters.adoc[]

- Response Fields
include::{snippets}/house-controller-test/get-house-info-success/response-fields.adoc[]

==== 404 실패
요청한 House의 정보를 찾을 수 없습니다.

- HTTP Request
include::{snippets}/house-controller-test/get-house-info-fail/http-request.adoc[]

- HTTP Response
include::{snippets}/house-controller-test/get-house-info-fail/http-response.adoc[]

- Path parameters
include::{snippets}/house-controller-test/get-house-info-fail/path-parameters.adoc[]

- Response Fields
include::{snippets}/house-controller-test/get-house-info-fail/response-fields.adoc[]

=== POST /houses
ver1: 요청한 House의 정보를 DB에 저장합니다.

==== 201 성공
DB에 성공적으로 저장합니다.
게스트 하우스 이름, 전화번호, 추가정보, 이미지를 form-data에 넣어서 요청합니다.

- HTTP Request
```
POST /api/v1/houses HTTP/1.1
Content-Type: multipart/form-data
Host: 13.124.108.177:8080
```

- Request Parameters
|===
| Parameter	 | Description

| file
| 이미지 파일(NULL❌)

| name
| 이름(50자이내 필수값)

| mainNumber
| 전화번호(숫자만, 11자이내 필수값)

| extra
| 게스트 하우스 추가 정보(NULL❌)
|===

- HTTP Response
```
HTTP/1.1 201 Created
```

==== 400 실패 (이름/전화번호)
이름과 전화번호의 유효성 검사에 실패합니다.

이름과 전화번호는 함께 검사하므로 errors라는 배열에 상세 내용이 담깁니다.

- HTTP Request
```
POST /api/v1/houses HTTP/1.1
Content-Type: multipart/form-data
Host: 13.124.108.177:8080
```

- Request Parameters
|===
| Parameter	 | Description

| file
| 이미지 파일(NULL❌)

| name
| 이름(50자이내 필수값)

| mainNumber
| 전화번호(숫자만, 11자이내 필수값)

| extra
| 게스트 하우스 추가 정보(NULL❌)
|===

- HTTP Response
```
HTTP/1.1 400 Bad Request
Content-Type: application/json;charset=UTF-8

{
  "message" : "입력값이 올바르지 않습니다.",
  "code" : "???",
  "status" : 400,
  "errors" : [ {
    "field" : "mainNumber",
    "value" : "01012-3456-11178",
    "reason" : "전화번호는 9~11자의 숫자만 입력해주세요."
  }, {
    "field" : "name",
    "value" : "",
    "reason" : "게스트 하우스 이름을 입력해주세요."
  } ]
}

```

- Response Fields
include::{snippets}/house-controller-test/validation/response-fields.adoc[]

==== 400 실패 (추가 정보)
추가 정보의 개수가 16개 이상인 경우 예외를 반환합니다.

- HTTP Request
include::{snippets}/house-controller-test/number-exceeded-exception/http-request.adoc[]

- HTTP Response
include::{snippets}/house-controller-test/number-exceeded-exception/http-response.adoc[]

- Response Fields
include::{snippets}/house-controller-test/number-exceeded-exception/response-fields.adoc[]

==== 500 실패 (이미지 업로드)
이미지의 크기가 서버에 업로드 가능한 크기를 초과한 경우 예외를 반환합니다.

- HTTP Request
include::{snippets}/house-controller-test/file-size-limit-exceeded-exception/http-request.adoc[]

- HTTP Response
include::{snippets}/house-controller-test/file-size-limit-exceeded-exception/http-response.adoc[]

- Response Fields
include::{snippets}/house-controller-test/file-size-limit-exceeded-exception/response-fields.adoc[]

==== 500 실패 (이미지 변환)
multipartFile을 File로 변환에 실패합니다.

- HTTP Request
include::{snippets}/house-controller-test/cannot-convert-exception/http-request.adoc[]

- HTTP Response
include::{snippets}/house-controller-test/cannot-convert-exception/http-response.adoc[]

- Response Fields
include::{snippets}/house-controller-test/cannot-convert-exception/response-fields.adoc[]

== 약관 관련 API

=== GET /terms
ver1: 모든 약관 리스트를 요청합니다.

==== 200 성공
요청한 약관 리스트를 성공적으로 가져옵니다.

- HTTP Request
include::{snippets}/terms-controller-test/list/http-request.adoc[]

- HTTP Response
include::{snippets}/terms-controller-test/list/http-response.adoc[]

- Response Fields
include::{snippets}/terms-controller-test/list/response-fields.adoc[]

== 회원가입 관련 API
회원가입을 실시합니다.

중복 검사에서 중복이 있는🙆‍♀️⭕ 경우 **true**를,

중복이 없는🙅‍♀️❌ 경우에는 **false**를 반환합니다.

✨주의✨ DB에 요청한 값이 `존재하는지`가 기준입니다. 실수하지 않도록 다시 한번 확인해보아요.


=== POST /users/check-email
ver1: 이메일 중복 검사를 요청합니다.

==== 200 성공
중복검사를 완료합니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/check-email/http-request.adoc[]

- HTTP Response
include::{snippets}/sign-up-controller-test/check-email/http-response.adoc[]

- Request Fields
include::{snippets}/sign-up-controller-test/check-email/request-fields.adoc[]

=== POST /users/check-name
ver1: 이름 중복 검사를 요청합니다.

==== 200 성공
중복검사를 완료합니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/check-name/http-request.adoc[]

- HTTP Response
include::{snippets}/sign-up-controller-test/check-name/http-response.adoc[]

- Request Fields
include::{snippets}/sign-up-controller-test/check-name/request-fields.adoc[]

=== POST /users
ver1: 회원가입을 요청합니다.

호스트 `이메일, 닉네임, 비밀번호, 프로필 사진, 마케팅 동의 여부` 를 form-data에 넣어서 요청합니다.

이미지가 없는 경우 null이 아닌 `빈 값` 으로 보내주세요.

==== 201 성공
성공적으로 등록되었습니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/join/http-request.adoc[]

- HTTP Response
include::{snippets}/sign-up-controller-test/join/http-response.adoc[]

- Request Part Body
include::{snippets}/sign-up-controller-test/join/request-part-file-body.adoc[]

- Request Parameters
include::{snippets}/sign-up-controller-test/join/request-parameters.adoc[]

==== 400 실패 (유효성 검사)
유효한 값이 아니므로 실패합니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/join_validation/http-request.adoc[]

- HTTP Response
include::{snippets}/sign-up-controller-test/join_validation/http-response.adoc[]

- Request Parameters
include::{snippets}/sign-up-controller-test/join_validation/request-parameters.adoc[]

- Response Fields
include::{snippets}/sign-up-controller-test/join_validation/response-fields.adoc[]

==== 500 실패 (이미지 크기 초과)
이미지 파일의 크기가 10MB 이상입니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/join-image-file-exceeded-exception/http-request.adoc[]

- HTTP Response
include::{snippets}/sign-up-controller-test/join-image-file-exceeded-exception/http-response.adoc[]

- Response Fields
include::{snippets}/sign-up-controller-test/join-image-file-exceeded-exception/response-fields.adoc[]

==== 500 실패 (이미지 변환 실패)
이미지 파일을 내부적으로 변환하는데 실패했습니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/join-image-cannot-convert-file/http-request.adoc[]

- HTTP Response
include::{snippets}/sign-up-controller-test/join-image-cannot-convert-file/http-response.adoc[]

- Response Fields
include::{snippets}/sign-up-controller-test/join-image-cannot-convert-file/response-fields.adoc[]

==== 409 실패 (중복)
이미 등록된 호스트가 존재합니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/join-duplication/http-request.adoc[]

- HTTP Response
include::{snippets}/sign-up-controller-test/join-duplication/http-response.adoc[]

- Response Fields
include::{snippets}/sign-up-controller-test/join-duplication/response-fields.adoc[]

=== GET users/auth?email=&authkey=
ver1: 회원가입시 호스트 이메일로 전송되는 인증 링크와 연결된 인증 API입니다.

==== 201 성공
성공적으로 인증되었습니다.
인증이 완료되면 인증 완료 문구만 String으로 반환됩니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/join-confirm/http-request.adoc[]

- HTTP Response
include::{snippets}/sign-up-controller-test/join-confirm/http-response.adoc[]

- Request Parameters
include::{snippets}/sign-up-controller-test/join-confirm/request-parameters.adoc[]

==== 401 실패 (인증키 불일치)
authKey 불일치로 인증에 실패했습니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/fail-to-auth/http-request.adoc[]

- HTTP Response
include::{snippets}/sign-up-controller-test/fail-to-auth/http-response.adoc[]

- Response Fields
include::{snippets}/sign-up-controller-test/fail-to-auth/response-fields.adoc[]

==== 401 실패 (인증 중복)
이미 인증된 호스트입니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/duplicate-auth/http-request.adoc[]

- HTTP Response
include::{snippets}/sign-up-controller-test/duplicate-auth/http-response.adoc[]

- Response Fields
include::{snippets}/sign-up-controller-test/duplicate-auth/response-fields.adoc[]

==== 401 실패 (인증키 만료)
authKey의 만료시간이 초과되었습니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/expiration/http-request.adoc[]

- HTTP Response
include::{snippets}/sign-up-controller-test/expiration/http-response.adoc[]

- Response Fields
include::{snippets}/sign-up-controller-test/expiration/response-fields.adoc[]

==== 404 실패 (호스트)
요청한 email에 해당하는 호스트가 존재하지 않습니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/not-found-host/http-request.adoc[]

- HTTP Response
include::{snippets}/sign-up-controller-test/not-found-host/http-response.adoc[]

- Response Fields
include::{snippets}/sign-up-controller-test/not-found-host/response-fields.adoc[]

==== 500 실패 (메일 전송)
메일 전송에 실패했습니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/fail-to-send-mail/http-request.adoc[]

- HTTP Response
include::{snippets}/sign-up-controller-test/fail-to-send-mail/http-response.adoc[]

- Response Fields
include::{snippets}/sign-up-controller-test/fail-to-send-mail/response-fields.adoc[]
