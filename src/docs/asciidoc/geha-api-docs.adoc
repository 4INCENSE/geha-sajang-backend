= ✨게하사장✨ API Docs
0.0.1, 2020/08/13
:toc: left
:sectnums:
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toclevels: 5
:sectlinks:

[[overview]]
= 개요

👩‍💻👨‍💻👩‍💻👨‍💻INCENSE 게하사장 서비스의 API를 정리해놓은 문서입니다.

API서버이므로 기본 Url은 **/api/v1(버전)/~** 입니다.

현재 버전은 ``**ver1**`` 입니다.

예) `http://13.124.108.177:8080/api/v1/houses/1`

.Method
- method는 아래와 같습니다.

|===
| Method | Content

| `GET`
| 읽기

| `POST`
| 추가

| `PATCH`
| 수정

| `DELETE`
| 삭제
|===

.Http Status Code
- Http Status Code는 아래와 같습니다.

|===
| Status code | Usage

| `200 OK`
| 요청이 성공했습니다.

| `201 Created`
| 요청한 리소스가 생성되었습니다.

| `204 No Content`
| 요청은 성공했지만 특별한 Response는 없습니다.

| `400 Bad Request`
| 잘못된 요청입니다.

| `404 Not Found`
| 리소스를 찾을 수 없습니다.

| `409 Conflict`
| DB에 이미 존재하는 데이터입니다.

| `500 INTERNAL_SERVER_ERROR`
| 서버 내부 에러입니다.
|===

.Error Code
- 내부적으로 사용하는 에러코드는 아래와 같습니다.

??? 주로 유효성 검사
|===
| Error code | Status | Message

| `???`
|  400
|  입력값이 올바르지 않습니다

|===

House 관련
|===
| Error code | Status | Message

| `HO_001`
|  404
|  해당 하우스를 찾을 수 없습니다.

| `HO_002`
|  400
|  지정된 숫자를 초과하였습니다.

|===

호스트 관련
|===
| Error code | Status | Message

| `US_001`
|  409
|  이미 등록된 호스트입니다.

| `US_002`
|  404
|  호스트를 찾을 수 없습니다.

| `US_003`
|  401
|  인증키가 올바르지 않습니다.

| `US_004`
|  401
|  이미 인증이 완료된 호스트입니다.

| `US_005`
|  401
|  만료된 인증키입니다.

|===

이미지 관련
|===
| Error code | Status | Message

| `IMG_001`
|  500
|  10MB이하의 파일만 가능합니다

| `IMG_002`
|  500
|  MultipartFile -> File로 전환이 실패했습니다

|===

메일 관련
|===
| Error code | Status | Message

| `MA_001`
|  500
|  메일 전송에 실패했습니다

|===

== House 관련 API

=== GET /houses/{houseId}
ver1: 요청한 house id의 house 정보를 가져옵니다.

- HTTP Request
include::{snippets}/house-controller-test/get-house-info-success/http-request.adoc[]

- Path parameters
include::{snippets}/house-controller-test/get-house-info-success/path-parameters.adoc[]

==== 200 성공
요청한 House의 정보를 성공적으로 가져옵니다.

- HTTP Response
```
HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8

{
  "houseId" : 1,
  "name" : "게스트하우스",
  "city" : "city",
  "street" : "street",
  "postcode" : "postcode",
  "detail" : "detail",
  "mainImage" : "",
  "thumbnailImage" : null,
  "mainNumber" : 12345678,
  "houseExtraInfoDtos" : [ {
    "title" : "추가1",
    "houseExtraInfoId" : 1
  }, {
    "title" : "추가2",
    "houseExtraInfoId" : 2
  }, {
    "title" : "추가3",
    "houseExtraInfoId" : 3
  } ]
}
```

- Response Fields

Type에 null은 신경 안쓰셔도 됩니다.
include::{snippets}/house-controller-test/get-house-info-success/response-fields.adoc[]

==== 404 실패
요청한 House의 정보를 찾을 수 없습니다.

- HTTP Response
```
HTTP/1.1 404 Not Found
Content-Type: application/json;charset=UTF-8

{
  "message" : "해당 하우스를 찾을 수 없습니다.",
  "code" : "HO_001",
  "status" : 404,
  "errors" : [ ]
}
```

- Response Fields
include::{snippets}/house-controller-test/get-house-info-fail/response-fields.adoc[]

=== POST /houses
ver1: 요청한 House의 정보를 DB에 저장합니다. 게스트 하우스 이름, 전화번호, 추가정보, 이미지를 form-data에 넣어서 요청합니다.

NOTE: 이미지와 추가 정보에 null 체크를 추가했으므로 null로 보내셔도 됩니다.

- HTTP Request
```
POST /api/v1/houses HTTP/1.1
Content-Type: multipart/form-data
Host: 13.124.108.177:8080
```

- Request Parameters
|===
| Parameter	 | Description

| image
| 이미지 파일(NULL⭕/""⭕)

| name
| 이름(50자이내 필수값)

| mainNumber
| 전화번호(숫자만, 11자이내 필수값)

| extra
| 게스트 하우스 추가 정보(NULL⭕/""⭕)
|===

==== 201 성공
DB에 성공적으로 저장합니다.

- HTTP Response
```
HTTP/1.1 201 Created
```

==== 400 실패 (이름/전화번호)
이름과 전화번호의 유효성 검사에 실패합니다.

이름과 전화번호는 함께 검사하므로 errors라는 배열에 상세 내용이 담깁니다.

- HTTP Response
```
HTTP/1.1 400 Bad Request
Content-Type: application/json;charset=UTF-8

{
  "message" : "입력값이 올바르지 않습니다.",
  "code" : "???",
  "status" : 400,
  "errors" : [ {
    "field" : "mainNumber",
    "value" : "01012-3456-11178",
    "reason" : "전화번호는 9~11자의 숫자만 입력해주세요."
  }, {
    "field" : "name",
    "value" : "",
    "reason" : "게스트 하우스 이름을 입력해주세요."
  } ]
}

```

- Response Fields
include::{snippets}/house-controller-test/validation/response-fields.adoc[]

==== 400 실패 (추가 정보)
추가 정보의 개수가 16개 이상인 경우 예외를 반환합니다.

- HTTP Response
```
HTTP/1.1 400 Bad Request
Content-Type: application/json;charset=UTF-8

{
  "message" : "지정된 숫자를 초과하였습니다.",
  "code" : "HO_002",
  "status" : 400,
  "errors" : [ ]
}

```

- Response Fields
include::{snippets}/house-controller-test/number-exceeded-exception/response-fields.adoc[]

==== 500 실패 (이미지 업로드)
이미지의 크기가 서버에 업로드 가능한 크기(10MB)를 초과한 경우 예외를 반환합니다.


- HTTP Response
```
HTTP/1.1 500 Internal Server Error
Content-Type: application/json;charset=UTF-8

{
  "message" : "10MB이하의 파일만 가능합니다.",
  "code" : "IMG_001",
  "status" : 500,
  "errors" : [ ]
}
```

- Response Fields
include::{snippets}/house-controller-test/file-size-limit-exceeded-exception/response-fields.adoc[]

==== 500 실패 (이미지 변환)
multipartFile을 File로 변환에 실패합니다.


- HTTP Response
```
HTTP/1.1 500 Internal Server Error
Content-Type: application/json;charset=UTF-8

{
  "message" : "MultipartFile -> File로 전환이 실패했습니다.",
  "code" : "IMG_002",
  "status" : 500,
  "errors" : [ ]
}
```

- Response Fields
include::{snippets}/house-controller-test/cannot-convert-exception/response-fields.adoc[]

== 약관 관련 API

=== GET /terms
ver1: 모든 약관 리스트를 요청합니다.

- HTTP Request
include::{snippets}/terms-controller-test/list/http-request.adoc[]

==== 200 성공
요청한 약관 리스트를 성공적으로 가져옵니다.

- HTTP Response
```
HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8

[ {
  "terms_id" : 1,
  "type" : "이용약관",
  "contents" : "이용약관 내용"
}, {
  "terms_id" : 2,
  "type" : "개인정보",
  "contents" : "개인정보 내용"
}, {
  "terms_id" : 3,
  "type" : "마케팅",
  "contents" : "마케팅 내용"
} ]
```

- Response Fields
include::{snippets}/terms-controller-test/list/response-fields.adoc[]

== 회원가입 관련 API
회원가입을 실시합니다.

중복 검사에서 중복이 있는🙆‍♀️⭕ 경우 **true**를,

중복이 없는🙅‍♀️❌ 경우에는 **false**를 반환합니다.

CAUTION: ✨주의✨ DB에 요청한 값이 `존재하는지`가 기준입니다. 실수하지 않도록 다시 한번 확인해보아요.


=== POST /users/check-email
ver1: 이메일 중복 검사를 요청합니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/check-email/http-request.adoc[]

- Request Fields
include::{snippets}/sign-up-controller-test/check-email/request-fields.adoc[]

==== 200 성공
중복검사를 완료합니다.

- HTTP Response
```
HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8

true
```

==== 400 실패
이메일을 입력하지 않았거나 이메일 형식에 맞지 않습니다.

=== POST /users/check-name
ver1: 이름 중복 검사를 요청합니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/check-name/http-request.adoc[]

- Request Fields
include::{snippets}/sign-up-controller-test/check-name/request-fields.adoc[]

==== 200 성공
중복검사를 완료합니다.

- HTTP Response
```
HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8

true
```

==== 400 실패
닉네임이 2~10자 이내가 아닙니다.

=== POST /users
ver1: 회원가입을 요청합니다.

호스트 `이메일, 닉네임, 비밀번호, 프로필 사진, 마케팅 동의 여부` 를 form-data에 넣어서 요청합니다.

❌이미지가 없는 경우 null이 아닌 `빈 값` 으로 보내주세요.❌ +
👉 수정했습니다.

NOTE: 이미지 null 체크를 추가했으므로 null로 보내셔도 됩니다. +
대신 마케팅 선택 약관 동의 여부는 ``**__NOT NULL__**`` 입니다.


- HTTP Request
```
POST /api/v1/users HTTP/1.1
Content-Type: multipart/form-data
Host: 13.124.108.177:8080
```

- Request Parameters
|===
| Parameter	 | Description

| image
| 이미지 파일(NULL⭕/""⭕)

| email
| 이메일(형식 필수)

| nickname
| 닉네임(2~10자 이내)

| password
| 문자+숫자 8~16자 이내

| isAgreeToMarketing
| 마케팅 선택 약관 동의 여부 (NULL❌)
|===

==== 201 성공
성공적으로 등록되었습니다.

- HTTP Response
```
HTTP/1.1 201 Created
```

==== 400 실패 (유효성 검사)
유효한 값이 아니므로 실패합니다.

- HTTP Response
```
HTTP/1.1 400 Bad Request
Content-Type: application/json;charset=UTF-8

{
  "message" : "입력값이 올바르지 않습니다.",
  "code" : "???",
  "status" : 400,
  "errors" : [ {
    "field" : "password",
    "value" : "1",
    "reason" : "비밀번호는 숫자+문자 조합으로 8~16자로 입력해주세요."
  }, {
    "field" : "email",
    "value" : "email",
    "reason" : "이메일 형식을 지켜주세요."
  }, {
    "field" : "nickname",
    "value" : "a",
    "reason" : "닉네임은 2~10자까지만 가능합니다."
  } ]
}
```

- Response Fields
include::{snippets}/sign-up-controller-test/join_validation/response-fields.adoc[]

==== 500 실패 (이미지 크기 초과)
이미지 파일의 크기가 10MB 이상입니다.

- HTTP Response
```
HTTP/1.1 500 Internal Server Error
Content-Type: application/json;charset=UTF-8

{
  "message" : "10MB이하의 파일만 가능합니다.",
  "code" : "IMG_001",
  "status" : 500,
  "errors" : [ ]
}
```

- Response Fields
include::{snippets}/sign-up-controller-test/join-image-file-exceeded-exception/response-fields.adoc[]

==== 500 실패 (이미지 변환 실패)
이미지 파일을 내부적으로 변환하는데 실패했습니다.

- HTTP Response
```
HTTP/1.1 500 Internal Server Error
Content-Type: application/json;charset=UTF-8

{
  "message" : "MultipartFile -> File로 전환이 실패했습니다.",
  "code" : "IMG_002",
  "status" : 500,
  "errors" : [ ]
}
```

- Response Fields
include::{snippets}/sign-up-controller-test/join-image-cannot-convert-file/response-fields.adoc[]

==== 409 실패 (중복)
이미 등록된 호스트가 존재합니다.

- HTTP Response
```
HTTP/1.1 409 Conflict
Content-Type: application/json;charset=UTF-8

{
  "message" : "이미 등록된 호스트입니다.",
  "code" : "US_001",
  "status" : 409,
  "errors" : [ ]
}
```

- Response Fields
include::{snippets}/sign-up-controller-test/join-duplication/response-fields.adoc[]

=== GET users/auth?email=&authkey=
ver1: 회원가입시 호스트 이메일로 전송되는 인증 링크와 연결된 인증 API입니다.

- HTTP Request
include::{snippets}/sign-up-controller-test/join-confirm/http-request.adoc[]

- Request Parameters
include::{snippets}/sign-up-controller-test/join-confirm/request-parameters.adoc[]

==== 201 성공
성공적으로 인증되었습니다.
인증이 완료되면 인증 완료 문구만 String으로 반환됩니다.

- HTTP Response
```
HTTP/1.1 201 Created
Content-Type: text/plain;charset=UTF-8

인증되었습니다.
```

==== 401 실패 (인증키 불일치)
authKey 불일치로 인증에 실패했습니다.

- HTTP Response
```
HTTP/1.1 401 Unauthorized
Content-Type: application/json;charset=UTF-8

{
  "message" : "인증키가 올바르지 않습니다.",
  "code" : "US_003",
  "status" : 401,
  "errors" : [ ]
}
```

- Response Fields
include::{snippets}/sign-up-controller-test/fail-to-auth/response-fields.adoc[]

==== 401 실패 (인증 중복)
이미 인증된 호스트입니다.

- HTTP Response
```
HTTP/1.1 401 Unauthorized
Content-Type: application/json;charset=UTF-8

{
  "message" : "이미 인증이 완료된 호스트입니다.",
  "code" : "US_004",
  "status" : 401,
  "errors" : [ ]
}
```

- Response Fields
include::{snippets}/sign-up-controller-test/duplicate-auth/response-fields.adoc[]

==== 401 실패 (인증키 만료)
authKey의 만료시간이 초과되었습니다.

- HTTP Response
```
HTTP/1.1 401 Unauthorized
Content-Type: application/json;charset=UTF-8

{
  "message" : "만료된 인증키입니다.",
  "code" : "US_005",
  "status" : 401,
  "errors" : [ ]
}
```

- Response Fields
include::{snippets}/sign-up-controller-test/expiration/response-fields.adoc[]

==== 404 실패 (호스트)
요청한 email에 해당하는 호스트가 존재하지 않습니다.

- HTTP Response
```
HTTP/1.1 404 Not Found
Content-Type: application/json;charset=UTF-8

{
  "message" : "호스트를 찾을 수 없습니다.",
  "code" : "US_002",
  "status" : 404,
  "errors" : [ ]
}
```

- Response Fields
include::{snippets}/sign-up-controller-test/not-found-host/response-fields.adoc[]

==== 500 실패 (메일 전송)
메일 전송에 실패했습니다.

- HTTP Response
```
HTTP/1.1 500 Internal Server Error
Content-Type: application/json;charset=UTF-8

{
  "message" : "메일 전송에 실패했습니다.",
  "code" : "MA_001",
  "status" : 500,
  "errors" : [ ]
}
```

- Response Fields
include::{snippets}/sign-up-controller-test/fail-to-send-mail/response-fields.adoc[]
